!function(e){"use strict";var t;t=angular.module("CoWebYi",["CoWebYiTemplates","ui.router","pascalprecht.translate","ui.codemirror","ui.ace"]),t.config(["$locationProvider","$translateProvider","$urlRouterProvider","$stateProvider",function(e,t,n,r){var i;return i="en",t.preferredLanguage(i),r.state("ide",{url:"/ide",views:{sidebar:{templateUrl:"templates/ide-sidebar.html"},container:{templateUrl:"templates/ide-form.html"}}}),r.state("schema",{url:"/schema",views:{sidebar:{templateUrl:"templates/project-sidebar.html"},container:{templateUrl:"templates/schema-form.html"}}}),r.state("schema.create",{url:"/create"}),r.state("schema.update",{url:"/update/:_id"}),r.state("requrl",{url:"/requrl",views:{sidebar:{templateUrl:"templates/project-sidebar.html"},container:{templateUrl:"templates/requrl-form.html"}}}),r.state("requrl.create",{url:"/create"}),r.state("requrl.update",{url:"/update/:_id"}),r.state("action",{url:"/action",views:{sidebar:{templateUrl:"templates/project-sidebar.html"},container:{templateUrl:"templates/action-form.html"}}}),r.state("action.create",{url:"/create"}),r.state("action.update",{url:"/update/:_id"}),r.state("codefile",{url:"/codefile",views:{sidebar:{templateUrl:"templates/project-sidebar.html"},container:{templateUrl:"templates/codefile-form.html"}}}),r.state("codefile.create",{url:"/create"}),r.state("codefile.update",{url:"/update/:_id"}),r.state("appitem",{url:"/appitem",views:{sidebar:{templateUrl:"templates/app-item-sidebar.html"},container:{templateUrl:"templates/app-item-form.html"}}}),r.state("appitem.create",{url:"/create"}),r.state("appitem.update",{url:"/update/:_id"}),n.otherwise("/appitem")}]),t.controller("ActionCtrl",["AppConfig","$scope","Action","$state","$stateParams","SocketConnect",function(e,t,n,r,i,a){return t.app=e,e.active="action",r.is("action.create")?t.model=n.create():r.is("action.update")&&n.findById(i._id).then(function(e){if(e.error_code)throw e;return t.$apply(function(){return t.model=e})}).fail(function(){return r.go("action.create")}).done(),t.$on("$stateChangeSuccess",function(){return r.reload()}),t.addParame=function(){return t.model.parames.push(new n.getParame)},t.delParame=function(e){return t.model.parames.splice(e,1)},t.save=function(){return n.save(t.model).then(function(e){return r.go("action.update",{_id:e._id}),console.log(e._id),e}).then(function(e){return a.emit("RunActionTest",e)}).fail(function(e){return console.log(e)}).done()},t.aceLoaded=function(e){return e.setFontSize(14),e.getSession().setUseSoftTabs(!1),e.getSession().setTabSize(4)}}]),t.controller("AppItemCtrl",["AppConfig","$scope","AppItem","$state","$stateParams",function(e,t,n,r,i){return t.app=e,e.active="appitem",t.config=function(){return{debug:!0}}(),r.is("appitem.create")?t.model=n.create():r.is("appitem.update")?n.findById(i._id).then(function(e){return t.$apply(function(){return t.model=e})}):t.model=n.create(),t.$on("$stateChangeSuccess",function(){return r.reload()}),t.save=function(){return n.save(t.model).then(function(e){return r.go("appitem.update",{_id:e._id})})}}]),t.controller("AppItemSidebarCtrl",["AppConfig","$scope","$state","AppItem",function(t,n,r,i){return n.app=t,n.AppItem=i,Q.fcall(function(){return i.getList()}).then(function(){return n.$apply()}),n.del=function(e,t){return i.del(e._id),n.appitems.splice(t,1)},n.intoProject=function(t){return e.localStorage.app_item_id=t,r.go("schema.create")}}]),t.controller("CodeFileCtrl",["AppConfig","$scope","CodeFile","$state","$stateParams","SocketConnect",function(e,t,n,r,i,a){return t.app=e,e.active="codefile",r.is("codefile.create")?t.model=n.create():r.is("codefile.update")&&n.findById(i._id).then(function(e){if(e.error_code)throw e;return t.$apply(function(){return t.model=e})}).fail(function(){return r.go("codefile.create")}).done(),t.$on("$stateChangeSuccess",function(){return r.reload()}),t.code_types=n.code_types,t.save=function(){return n.save(t.model).then(function(e){return r.go("codefile.update",{_id:e._id}),console.log(e._id),e}).then(function(e){return a.emit("GenerateCodeFile",e)}).fail(function(e){return console.log(e)}).done()},t.aceLoaded=function(e){return e.setFontSize(14),e.getSession().setUseSoftTabs(!1),e.getSession().setTabSize(4)}}]),t.controller("ConsolePannelCtrl",["AppConfig","$scope","ConsoleMessages",function(e,t,n){return t.ConsoleMessages=n,t.$watch("ConsoleMessages.messages.length",function(){return $(".console-pannel-content").scrollTop(9999999)}),t.y=500,t.move=function(e,n){return t.$apply(function(){return t.y=n})}}]),t.controller("IdeCtrl",["AppConfig","$scope","FileModel",function(e,t,n){return t.app=e,e.active="ide",t.FileModel=n,t.activeTab=function(e){return n.active_tab=e.path,n.showInEdit(e)}}]),t.controller("IdeSidebarCtrl",["AppConfig","$scope","FileModel","AppItem",function(e,t,n,r){return t.app=e,e.active="ide",e.getCurAppItemId().then(function(e){return r.findById(e)}).then(function(e){return t.$apply(function(){return t.item={path:e.directory,name:e.name,type:"folder"}})}),t.getChilds=function(e){return"folder"===e.type?e.childs?e.childs=null:n.findByDir(e.path+"/").then(function(n){return t.$apply(function(){return e.childs=n})}):void 0},t.edit=function(e){return"file"===e.type?n.addSelect(e):void 0}}]),t.controller("NavbarCtrl",["AppConfig","$scope",function(e,t){return t.app=e}]),t.controller("ProjectSidebarCtrl",["AppConfig","$scope","SocketConnect","ConsoleMessages","Schema","Requrl","Action","CodeFile",function(e,t,n,r,i,a,o,s){return t.app=e,t.Action=o,t.Schema=i,t.Requrl=a,t.CodeFile=s,Q.all([i.getList(),a.getList(),o.getList(),s.getList()]).then(function(){return t.$apply()}),t.del=function(e,n,r){return"schema"===e?(i.del(n._id),t.schemas.splice(r,1)):"requrl"===e?(a.del(n._id),t.requrls.splice(r,1)):"action"===e?(o.del(n._id),t.actions.splice(r,1)):"view"===e?(s.del(n._id),t.actions.splice(r,1)):console.log("无效删除操作")},t.generateAppItem=function(){return e.getCurAppItemId().then(function(e){return n.emit("GenerateAppItem",e)}).done(),!0},t.runAppItem=function(){return e.getCurAppItemId().then(function(e){return n.emit("RunAppItem",e)}).done(),!0}}]),t.controller("RequrlCtrl",["AppConfig","$scope","Requrl","$state","$stateParams","SocketConnect",function(e,t,n,r,i,a){return t.app=e,e.active="requrl",t.requrl=n,r.is("requrl.create")?t.model=n.create():r.is("requrl.update")&&n.findById(i._id).then(function(e){if(e.error_code)throw e;return t.$apply(function(){return t.model=e})}).fail(function(){return r.go("requrl.create")}).done(),t.$on("$stateChangeSuccess",function(){return r.reload()}),t.addParame=function(e){return t.model[e].push(new n.getParame)},t.delParame=function(e,n){return t.model[e].splice(n,1)},t.save=function(){return n.save(t.model).then(function(e){return r.go("requrl.update",{_id:e._id}),console.log(e._id),e}).then(function(e){return a.emit("RunRequrlTest",e)})},t.editorOptions=function(){return{height:"100%",mode:"text/x-coffeescript",autoMatchParens:!0,textWrapping:!0,lineNumbers:!0,indentUnit:4,indentWithTabs:!0,theme:"ambiance"}}(),t.themes=["default","3024-day","3024-night","ambiance","base16-dark","base16-light","blackboard","cobalt","eclipse","elegant","erlang-dark","lesser-dark","mbo","mdn-like","midnight","monokai","neat","neo","night","paraiso-dark","paraiso-light","pastel-on-dark","rubyblue","solarized dark","solarized light","the-matrix","tomorrow-night-eighties","twilight","vibrant-ink","xq-dark","xq-light"]}]),t.controller("SchemaCtrl",["AppConfig","$scope","Schema","$state","$stateParams","SocketConnect",function(e,t,n,r,i,a){return t.app=e,e.active="schema",r.is("schema.create")?t.schema=n.create():r.is("schema.update")&&n.findById(i._id).then(function(e){return t.$apply(function(){return t.schema=e})}),t.$on("$stateChangeSuccess",function(){return r.reload()}),t.field_types=n.field_types,t.schemas=[],n.getList().then(function(e){return t.$apply(function(){var n,r,i,a;for(a=[],r=0,i=e.length;i>r;r++)n=e[r],a.push(t.schemas.push(n.model_name));return a})}),t.addField=function(){return t.schema.fields.push(new n.default_field)},t.delField=function(e){return t.schema.fields.splice(e,1)},t.addEnum=function(e){return e.enums.push({value:""})},t.delEnum=function(e,t){return e.enums.splice(t,1)},t.save=function(){return n.save(t.schema).then(function(e){return r.go("schema.update",{_id:e._id}),e}).then(function(e){return a.emit("RunSchameTest",e)}).fail(function(e){return console.log(e)}).done()}}]),t.directive("coOnDrag",["$document",function(e){return{priority:100,restrict:"EA",scope:{onMove:"=coOnDrag",initX:"@",initY:"@"},link:function(t,n){var r,i,a,o,s,l;return s=t.initX||0,l=t.initY||0,o=0,a=0,r=function(e){return l=e.screenY-o,s=e.screenX-a,t.onMove(s,l)},i=function(){return e.unbind("mousemove",r),e.unbind("mouseup",i)},n.on("mousedown",function(t){return t.preventDefault(),a=t.screenX-s,o=t.screenY-l,e.on("mousemove",r),e.on("mouseup",i)})}}}]);var n;t.directive("coRadio",n=function(){return{priority:100,template:'<div class="btn-group"> <button class="btn" ng-class="{active:select==item.key}" ng-repeat="item in enums" ng-click="setRadio(item)">{{item.value}}</button> </div>',replace:!0,transclude:!0,restrict:"AE",require:"?ngModel",scope:{enums:"=coRadio"},link:function(e,t,n,r){return r?(r.$render=function(){return e.select=r.$modelValue},e.setRadio=function(t){return e.select=t.key,r.$setViewValue(t.key)}):void 0}}});var n;t.directive("dialog",n=function(){return{priority:100,templateUrl:"templates/dialog.html",replace:!0,transclude:!0,restrict:"E",scope:{title:"@",onOk:"&",onCancel:"&",visible:"@"}}}),t.directive("onCtrlS",function(){return{priority:100,restrict:"AE",scope:{onCtrlS:"&"},link:function(e,t){return $(t).bind("keydown",function(t){return t.ctrlKey&&83===t.keyCode?(console.log("onCtrlS"),e.$apply(function(){return e.onCtrlS()}),t.preventDefault()):void 0})}}});var n;t.directive("planStatus",n=function(){return{priority:100,templateUrl:"templates/plan-status.html",replace:!0,restrict:"AE",require:"?ngModel",scope:{save:"&planStatus"},link:function(e,t,n,r){return r?(r.$render=function(){return e.status=r.$modelValue},e.setStatus=function(t){return e.status=t,r.$setViewValue(t),e.save()}):void 0}}}),t.factory("Action",["AppConfig","toast","GlobalLoading","$rootScope",function(e,t,n,r){var i,a;return i=function(){return{name:"",value:"",intro:""}},a=function(){return{name:null,parames:[new i],intro:null,code:null,test_code:null,creater_id:null,app_item_id:null,plan_status:"inprogress"}},{_models:[],getParame:i,create:function(){return new a},findById:function(r){var i;return n.show(),i=Q.defer(),$.ajax({type:"GET",url:e.api_domain+"action/findById",data:{_id:r,time:(new Date).getTime()},dataType:"JSON",success:function(e){return i.resolve(e),n.hide()},error:function(e){return t.show(e.toString()),i.reject(e),n.hide()}}),i.promise},save:function(t){var i;return i=this,n.show(),Q.all([e.getLoginerId(),e.getCurAppItemId()]).then(function(a){var o;return t.creater_id=a[0],t.app_item_id=a[1],o=Q.defer(),$.ajax({type:"POST",url:e.api_domain+"action/save",data:{model:t,time:(new Date).getTime()},dataType:"JSON",success:function(e){return n.hide(),e.error_code?o.reject(e):(t._id||r.$apply(function(){return i._models.push(e)}),o.resolve(e))},error:function(e){return n.hide(),o.reject(e)}}),o.promise})},del:function(t){var r,i;return i=this,n.show(),r=Q.defer(),$.ajax({type:"POST",url:e.api_domain+"action/del",data:{_id:t,time:(new Date).getTime()},dataType:"JSON",success:function(e){return r.resolve(e),n.hide()},error:function(e){return r.reject(e),n.hide()}}),r.promise},delByIndex:function(e){var t;return t=this,a=this._models[e],this.del(a._id).then(function(){return r.$apply(function(){return t._models.splice(e,1)})})},getList:function(){var t;return t=this,n.show(),Q.all([e.getLoginerId(),e.getCurAppItemId()]).then(function(r){var i,a,o;return a=r[0],i=r[1],o=Q.defer(),$.ajax({type:"GET",url:e.api_domain+"action/list",data:{creater_id:a,app_item_id:i,time:(new Date).getTime()},dataType:"JSON",success:function(e){return t._models=e,o.resolve(e),n.hide()},error:function(e){return o.reject(e),n.hide()}}),o.promise})}}}]),t.factory("AppConfig",["$compile","$templateCache","$rootScope",function(){return{api_domain:"/api/",name:"WEBYI",active:"home",getLoginerId:function(){return Q.fcall(function(){return"53a15d7648e4e96427b888db"})},getCurAppItemId:function(){return Q.fcall(function(){return e.localStorage.app_item_id})}}}]),t.factory("AppItem",["AppConfig","toast","GlobalLoading","$rootScope",function(e,t,n,r){var i;return i=function(){return{name:"",debug:!0,server_port:1080,db_host:"127.0.0.1",db_port:27017,db_name:"",db_username:"root",db_password:"",other_conf:""}},{models:[],create:function(){return new i},findById:function(r){var i;return n.show(),i=Q.defer(),$.ajax({type:"GET",url:e.api_domain+"appitem/findById",data:{_id:r,time:(new Date).getTime()},dataType:"JSON",success:function(e){return i.resolve(e),n.hide()},error:function(e){return t.show(e.toString()),i.reject(e),n.hide()}}),i.promise},save:function(t){return n.show(),Q.all([e.getLoginerId(),e.getCurAppItemId()]).then(function(r){var i;return t.creater_id=r[0],i=Q.defer(),$.ajax({type:"POST",url:e.api_domain+"appitem/save",data:{model:t,time:(new Date).getTime()},dataType:"JSON",success:function(e){return i.resolve(e),n.hide()},error:function(e){return i.reject(e),n.hide()}}),i.promise})},del:function(t){var r;return n.show(),r=Q.defer(),$.ajax({type:"POST",url:e.api_domain+"appitem/del",data:{_id:t,time:(new Date).getTime()},dataType:"JSON",success:function(e){return r.resolve(e),n.hide()},error:function(e){return r.reject(e),n.hide()}}),r.promise},delByIndex:function(e){var t;return t=this,i=this._models[e],this.del(i._id).then(function(){return r.$apply(function(){return t._models.splice(e,1)})})},getList:function(){var t;return t=this,n.show(),Q.all([e.getLoginerId(),e.getCurAppItemId()]).then(function(r){var i,a,o;return a=r[0],i=r[1],o=Q.defer(),$.ajax({type:"GET",url:e.api_domain+"appitem/list",data:{creater_id:a,time:(new Date).getTime()},dataType:"JSON",success:function(e){return t._models=e,o.resolve(e),n.hide()},error:function(e){return o.reject(e),n.hide()}}),o.promise})}}}]),t.factory("CodeFile",["AppConfig","toast","GlobalLoading","$rootScope",function(e,t,n,r){var i,a;return i=["html","javascript","coffee","css","stylus"],a=function(){return{name:"",code:"",intro:"",creater_id:"",app_item_id:"",code_type:"",plan_status:"inprogress"}},{code_types:i,_models:[],create:function(){return new a},findById:function(r){var i;return n.show(),i=Q.defer(),$.ajax({type:"GET",url:e.api_domain+"codefile/findById",data:{_id:r,time:(new Date).getTime()},dataType:"JSON",success:function(e){return i.resolve(e),n.hide()},error:function(e){return t.show(e.toString()),i.reject(e),n.hide()}}),i.promise},save:function(t){var i;return i=this,n.show(),Q.all([e.getLoginerId(),e.getCurAppItemId()]).then(function(a){var o;return t.creater_id=a[0],t.app_item_id=a[1],o=Q.defer(),$.ajax({type:"POST",url:e.api_domain+"codefile/save",data:{model:t,time:(new Date).getTime()},dataType:"JSON",success:function(e){return n.hide(),e.error_code?o.reject(e):(t._id||r.$apply(function(){return i._models.push(e)}),o.resolve(e))},error:function(e){return n.hide(),o.reject(e)}}),o.promise})},del:function(t){var r,i;return i=this,n.show(),r=Q.defer(),$.ajax({type:"POST",url:e.api_domain+"codefile/del",data:{_id:t,time:(new Date).getTime()},dataType:"JSON",success:function(e){return r.resolve(e),n.hide()},error:function(e){return r.reject(e),n.hide()}}),r.promise},delByIndex:function(e){var t;return t=this,a=this._models[e],this.del(a._id).then(function(){return r.$apply(function(){return t._models.splice(e,1)})})},getList:function(){var t;return t=this,n.show(),Q.all([e.getLoginerId(),e.getCurAppItemId()]).then(function(r){var i,a,o;return a=r[0],i=r[1],o=Q.defer(),$.ajax({type:"GET",url:e.api_domain+"codefile/list",data:{creater_id:a,app_item_id:i,time:(new Date).getTime()},dataType:"JSON",success:function(e){return t._models=e,o.resolve(e),n.hide()},error:function(e){return o.reject(e),n.hide()}}),o.promise})}}}]),t.factory("ConsoleMessages",["$rootScope",function(e){return{messages:[],add:function(t){return this.messages.length>100&&this.messages.splice(0,1),this.messages.push(t),console.log(t),e.$apply()}}}]),t.factory("FileModel",["AppConfig","toast","GlobalLoading","$rootScope",function(e,t,n,r){return{code_types:{coffee:"coffee",js:"javascript",html:"html",css:"css",styl:"stylus",less:"less"},findByDir:function(r){var i;return n.show(),i=Q.defer(),$.ajax({type:"GET",url:e.api_domain+"file/findByDir",data:{dir:r,time:(new Date).getTime()},dataType:"JSON",success:function(e){return i.resolve(e),n.hide()},error:function(e){return t.show(e.toString()),i.reject(e),n.hide()}}),i.promise},findContentByPath:function(r){var i;return n.show(),i=Q.defer(),$.ajax({type:"GET",url:e.api_domain+"file/findContentByPath",data:{path:r,time:(new Date).getTime()},dataType:"JSON",success:function(e){return i.resolve(e),n.hide()},error:function(e){return t.show(e.toString()),i.reject(e),n.hide()}}),i.promise},selects:[],addSelect:function(e){var t;return t=this.selects.some(function(t){return e.name===t.name&&e.path===t.path?!0:void 0}),t||this.selects.push(e),this.active_tab=e.path,this.showInEdit(e)},removeSelect:function(e){return this.selects.splice(e,1)},showInEdit:function(e){var t;return e.code||this.findContentByPath(e.path).then(function(t){return e.code=t.content,r.$apply()}),t=e.name.split(".")[1],e.code_type=this.code_types[t],this.active_item=e},save:function(){var r,i;return i=this.active_item,n.show(),r=Q.defer(),$.ajax({type:"POST",url:e.api_domain+"file/save",data:{path:i.path,content:i.code,time:(new Date).getTime()},dataType:"JSON",success:function(e){return r.resolve(e),n.hide()},error:function(e){return t.show(e.toString()),r.reject(e),n.hide()}}),r.promise}}}]),t.factory("GlobalLoading",function(){var e,t,n;return e="body",t=$("<div></div>").addClass("Co-loading").css({opacity:.85,zIndex:99999,position:"fixed",padding:"20px 30px",color:"#fff",top:0,right:0,bottom:0,left:0,textAlign:"center"}).text("……加载中……").appendTo(e).hide(),n=0,{show:function(){return function(){return t.show(),n++}}(this),hide:function(){return function(){return n--,1>n?t.hide():void 0}}(this)}}),t.factory("Requrl",["AppConfig","toast","GlobalLoading","$rootScope",function(e,t,n,r){var i,a,o,s;return o=["GET","POST","PUT","PATCH","DELETE","COPY","HEAD","OPTIONS","LINK","UNLINK","PURGE","ALL"],s=["TEXT","EXPRESS","FILE"],i=function(){return{name:"",value:"",value_type:"TEXT",is_require:!1,intro:""}},a=function(){return{title:"",path:"",type:"GET",intro:"",headers:[new i],gets:[new i],posts:[new i],code:"",test_code:"",creater_id:null,app_item_id:null,plan_status:"inprogress"}},{request_types:o,getParame:i,value_types:s,_models:[],create:function(){return new a},findById:function(r){var i;return n.show(),i=Q.defer(),$.ajax({type:"GET",url:e.api_domain+"requrl/findById",data:{_id:r,time:(new Date).getTime()},dataType:"JSON",success:function(e){return i.resolve(e),n.hide()},error:function(e){return t.show(e.toString()),i.reject(e),n.hide()}}),i.promise},save:function(t){var r;return n.show(),r=Q.defer(),Q.all([e.getLoginerId(),e.getCurAppItemId()]).then(function(i){return t.creater_id=i[0],t.app_item_id=i[1],$.ajax({type:"POST",url:e.api_domain+"requrl/save",data:{model:t,time:(new Date).getTime()},dataType:"JSON",success:function(e){return r.resolve(e),n.hide()},error:function(e){return r.reject(e),n.hide()}}),r.promise})},del:function(t){var r;return n.show(),r=Q.defer(),$.ajax({type:"POST",url:e.api_domain+"requrl/del",data:{_id:t,time:(new Date).getTime()},dataType:"JSON",success:function(e){return r.resolve(e),n.hide()},error:function(e){return r.reject(e),n.hide()}}),r.promise},delByIndex:function(e){var t;return t=this,a=this._models[e],this.del(a._id).then(function(){return r.$apply(function(){return t._models.splice(e,1)})})},getList:function(){var t;return t=this,n.show(),Q.all([e.getLoginerId(),e.getCurAppItemId()]).then(function(r){var i,a,o;return a=r[0],i=r[1],o=Q.defer(),$.ajax({type:"GET",url:e.api_domain+"requrl/list",data:{creater_id:a,app_item_id:i,time:(new Date).getTime()},dataType:"JSON",success:function(e){return t._models=e,o.resolve(e),n.hide()},error:function(e){return o.reject(e),n.hide()}}),o.promise})}}}]),t.factory("Schema",["AppConfig","toast","GlobalLoading","$rootScope",function(e,t,n,r){var i,a,o;return a=["ObjectId","String","Number","Date","Array","Email","Mixed"],i=function(){return{name:"",type:"String",sub_schema:"",enums:[],"default":"",intro:""}},o=function(){return{model_name:"",table_name:"",fields:[new i],creater_id:null,app_item_id:null,plan_status:"inprogress"}},{field_types:a,default_field:i,model:o,_models:[],create:function(){return new o},findById:function(r){var i;return n.show(),i=Q.defer(),$.ajax({type:"GET",url:e.api_domain+"schema/findById",data:{_id:r,time:(new Date).getTime()},dataType:"JSON",success:function(e){return i.resolve(e),n.hide()},error:function(e){return t.show(e),i.reject(e),n.hide()}}),i.promise},save:function(t){return n.show(),Q.all([e.getLoginerId(),e.getCurAppItemId()]).then(function(r){var i;return t.creater_id=r[0],t.app_item_id=r[1],i=Q.defer(),$.ajax({type:"POST",url:e.api_domain+"schema/save",data:{model:t,time:(new Date).getTime()},dataType:"JSON",success:function(e){return i.resolve(e),n.hide()},error:function(e){return i.reject(e),n.hide()}}),i.promise})},del:function(t){var r;return n.show(),r=Q.defer(),$.ajax({type:"POST",url:e.api_domain+"schema/del",data:{_id:t,time:(new Date).getTime()},dataType:"JSON",success:function(e){return r.resolve(e),n.hide()},error:function(e){return r.reject(e),n.hide()}}),r.promise},delByIndex:function(e){var t;return t=this,o=this._models[e],this.del(o._id).then(function(){return r.$apply(function(){return t._models.splice(e,1)})})},getList:function(){var t;return t=this,n.show(),Q.all([e.getLoginerId(),e.getCurAppItemId()]).then(function(r){var i,a,o;return a=r[0],i=r[1],o=Q.defer(),$.ajax({type:"GET",url:e.api_domain+"schema/list",data:{creater_id:a,app_item_id:i,time:(new Date).getTime()},dataType:"JSON",success:function(e){return t._models=e,o.resolve(e),n.hide()},error:function(e){return o.reject(e),n.hide()}}),o.promise})}}}]),t.factory("SocketConnect",["AppConfig","toast","GlobalLoading","$rootScope","ConsoleMessages",function(e,t,n,r,i){var a;return a=io.connect("http://127.0.0.1:1080"),a.on("message",function(e){return i.add(e),n.hide()}),{emit:function(e,t){return n.show("运行测试……"),a.emit(e,t)}}}]),t.factory("toast",function(){var t;return t="body",{show:function(n){var r;return r=$("<div></div>").addClass("Co-toast").css({opacity:.85,zIndex:99999,position:"fixed",background:"#000",padding:"20px 30px",color:"#fff",borderRadius:6}).text(n).appendTo(t),r.css({top:.5*($(e).height()-r.outerHeight()),left:.5*($(e).width()-r.outerWidth())}).delay(3e3).fadeOut(400)}}}),angular.module("CoWebYiTemplates",[]).run(["$templateCache",function(e){e.put("templates/action-form.html",'<div ng-controller="ActionCtrl" class="action-main">\r\n	<form ng-submit="save()" method="post" accept-charset="utf-8" on-ctrl-s="save()">\r\n		<ul class="form-header" ng-init="show_tab=2">\r\n			<li ng-click="show_tab=1" ng-class="{active: show_tab==1}">需求配置</li>\r\n			<li ng-click="show_tab=2" ng-class="{active: show_tab==2}">实现代码</li>\r\n			<li ng-click="show_tab=3" ng-class="{active: show_tab==3}">测试代码</li>\r\n		</ul>\r\n		<div class="form-main no-code" ng-if="show_tab==1">\r\n			<div>\r\n				<textarea ng-model="model.intro" placeholder="函数功能说明"></textarea>\r\n			</div>\r\n			<div>\r\n				<input type="text" ng-model="model.name" placeholder="函数名称" />\r\n			</div>\r\n			<h4>参数</h4>\r\n			<ul>\r\n				<li ng-repeat="parame in model.parames">\r\n					<input ng-model="parame.name" type="text" placeholder="参数名称" />\r\n					<input ng-model="parame.value" type="text" placeholder="参数值" />\r\n					<input ng-model="parame.intro" type="text" placeholder="参数描述" />\r\n					<a class="btn" ng-click="delParame($index)">-</a>\r\n				</li>\r\n				<li><a class="btn" ng-click="addParame()">+增加</a></li>\r\n			</ul>\r\n		</div>\r\n		<div class=\'form-main\' ng-if="show_tab==2">\r\n			<div ui-ace="{\r\n				useWrapMode : true,\r\n				showGutter: true,\r\n				theme:\'monokai\',\r\n				mode: \'coffee\',\r\n				onLoad: aceLoaded\r\n			}" ng-model="model.code" placeholder="实现代码"></div>\r\n		</div>\r\n		<div class=\'form-main\' ng-if="show_tab==3">\r\n			<div ui-ace="{\r\n				useWrapMode : true,\r\n				showGutter: true,\r\n				theme:\'monokai\',\r\n				mode: \'coffee\',\r\n				onLoad: aceLoaded\r\n			}" ng-model="model.test_code" placeholder="测试代码"></div>\r\n		</div>\r\n		<div class="form-footer">\r\n			<input class="btn btn-primary" type="submit" value="保存" />\r\n		</div>\r\n	</form>\r\n</div>'),e.put("templates/app-item-form.html",'<div ng-controller="AppItemCtrl" class="config-main">\r\n	<form ng-submit="save()" method="post" accept-charset="utf-8" on-ctrl-s="save()">\r\n		<ul class="form-header" ng-init="show_tab=1">\r\n			<li ng-click="show_tab=1" ng-class="{active: show_tab==1}">主配置</li>\r\n			<li ng-click="show_tab=2" ng-class="{active: show_tab==2}">其它配置</li>\r\n		</ul>\r\n		<div class="form-main no-code" ng-if="show_tab==1">\r\n			<div>\r\n				应用名称：<input type="text" ng-model="model.name" />\r\n			</div>\r\n			<div>\r\n				使用端口：<input type="text" ng-model="model.server_port" />\r\n			</div>\r\n			<div>\r\n				存放目录：<input type="text" ng-model="model.directory" />\r\n			</div>\r\n			<div>\r\n				开启DEBUG模式：\r\n				<div co-radio="[{key:false, value:\'关闭\'},{key:true,value:\'开启\'}]" ng-model="model.debug"></div>\r\n			</div>\r\n			<dl>\r\n				<dt>数据库配置</dt>\r\n				<dd>HOST： <input type="text" ng-model="model.db_host" /></dd>\r\n				<dd>端口： <input type="text" ng-model="model.db_port" /></dd>\r\n				<dd>库名： <input type="text" ng-model="model.db_name" /></dd>\r\n				<dd>用户名： <input type="text" ng-model="model.db_username" /></dd>\r\n				<dd>密码： <input type="text" ng-model="model.db_password" /></dd>\r\n			</dl>\r\n		</div>\r\n		<div class=\'form-main\' ng-if="show_tab==2">\r\n			<div ui-ace="{\r\n				useWrapMode : true,\r\n				showGutter: true,\r\n				theme:\'monokai\',\r\n				mode: \'coffee\',\r\n				onLoad: aceLoaded\r\n			}" ng-model="model.other_conf" placeholder="其它配置"></div>\r\n		</div>\r\n		<div class="form-footer">\r\n			<input class="btn btn-primary" type="submit" value="保存" />\r\n		</div>\r\n	</form>\r\n</div>'),e.put("templates/app-item-sidebar.html",'<ul ng-controller="AppItemSidebarCtrl">\r\n	<li>\r\n		<h4>项目管理</h4>\r\n		<a ui-sref="appitem.create" class="icon-plus sidebar-add-btn" title="添加"></a>\r\n		<ul>\r\n			<li class="sidebar-item-li" ng-repeat="appitem in AppItem._models">\r\n				<a ui-sref="appitem.update({_id: appitem._id})" class="title">\r\n					<span>{{appitem.name}}</span>\r\n				</a>\r\n				<a class="icon-minus right" ng-click="AppItem.delByIndex($index)" title="删除"></a>\r\n				<a class="icon-plus-sign right" title="测试"></a>\r\n				<a class="icon-play right" title="进入项目" ng-click="intoProject(appitem._id)"></a>\r\n			</li>\r\n		</ul>\r\n	</li>\r\n</ul>'),e.put("templates/codefile-form.html",'<div ng-controller="CodeFileCtrl" class="codefile-main">\r\n	<form ng-submit="save()" method="post" accept-charset="utf-8" on-ctrl-s="save()">\r\n		<ul class="form-header" ng-init="show_tab=2">\r\n			<li ng-click="show_tab=1" ng-class="{active: show_tab==1}">需求配置</li>\r\n			<li ng-click="show_tab=2" ng-class="{active: show_tab==2}">实现代码</li>\r\n			<li>\r\n				<span>代码类型:</span>\r\n				<select class="td-input" ng-model="model.code_type" ng-options="code_type for code_type in code_types"></select>\r\n			</li>\r\n		</ul>\r\n		<div class="form-main no-code" ng-if="show_tab==1">\r\n			<div>\r\n				<textarea ng-model="model.intro" placeholder="文件说明"></textarea>\r\n			</div>\r\n			<div>\r\n				<input type="text" ng-model="model.name" placeholder="文件名称" />\r\n			</div>\r\n		</div>\r\n		<div class=\'form-main\' ng-if="show_tab==2">\r\n			<div ui-ace="{\r\n				useWrapMode : true,\r\n				showGutter: true,\r\n				theme:\'monokai\',\r\n				mode: model.code_type,\r\n				onLoad: aceLoaded\r\n			}" ng-model="model.code" placeholder="代码"></div>\r\n		</div>\r\n		<div class="form-footer">\r\n			<input class="btn btn-primary" type="submit" value="保存" />\r\n		</div>\r\n	</form>\r\n</div>'),e.put("templates/console-pannel.html",'<div class="console-pannel-main" ng-init="ConsolePannelShown=true" ng-controller="ConsolePannelCtrl">\r\n	<div class="console-pannel-close-btn">\r\n		<p class="btn" ng-click="ConsolePannelShown=!ConsolePannelShown">收起<span class="icon-chevron-down"></span></p>\r\n		<p class="btn" ng-click="ConsoleMessages.messages=[]">清除<span class="icon-ban-circle"></span></p>\r\n	</div>\r\n	<div class="console-pannel-content" ng-show="ConsolePannelShown" ng-style="{top:y}">\r\n		<div class="console-pannel-drag-top" co-on-drag="move" init-y="{{y}}">==</div>\r\n		<ul >\r\n			<li ng-repeat="message in ConsoleMessages.messages">\r\n				{{message.content}}\r\n			</li>\r\n		</ul>\r\n	</div>\r\n</div>\r\n'),e.put("templates/dialog.html",'<div ng-show="visible" class="modal">\r\n	<div class="modal-header">\r\n		<a class="close" ng-click="onCancel()">×</a>\r\n		<h3 class="modal-title">{{title}}</h3>\r\n	</div>\r\n	<div class="modal-body" ng-transclude></div>\r\n	<div class="modal-footer">\r\n		<a ng-click="onCancel()" data-dismiss="modal" class="btn">关闭</a>\r\n		<a ng-click="onOk()" class="btn btn-primary">确定</a>\r\n	</div>\r\n</div>'),e.put("templates/edit-side-base-structure.html",'<div>\r\n	<div ng-dblclick="edit(item)" ng-click="getChilds(item)">{{item.name}}</div>\r\n	<ul ng-if="item.type==\'folder\'" ng-show="item.childs">\r\n		<li ng-repeat="item in item.childs|orderBy: \'-type\'" ng-include="\'templates/edit-side-base-structure.html\'"></li>\r\n	</ul>\r\n</div>'),e.put("templates/ide-form.html",'<div ng-controller="IdeCtrl" class="ide-main">\r\n	<form ng-submit="save()" method="post" accept-charset="utf-8" on-ctrl-s="FileModel.save()">\r\n		<ul class="form-header">\r\n			<li ng-repeat="item in FileModel.selects" ng-click="activeTab(item)" ng-class="{active: FileModel.active_tab==item.path}">{{item.name}} <span class="icon-remove" ng-click="FileModel.removeSelect($index)"></span></li>\r\n		</ul>\r\n		<div class=\'form-main\'>\r\n			<div ui-ace="{\r\n				useWrapMode : true,\r\n				showGutter: true,\r\n				theme:\'monokai\',\r\n				mode: FileModel.active_item.code_type,\r\n				onLoad: aceLoaded\r\n			}" ng-model="FileModel.active_item.code" placeholder="代码"></div>\r\n		</div>\r\n		<div class="form-footer">\r\n			<input class="btn btn-primary" type="submit" value="保存" />\r\n		</div>\r\n	</form>\r\n</div>'),e.put("templates/ide-sidebar.html",'<div ng-controller="IdeSidebarCtrl">\r\n	<div ng-include="\'templates/edit-side-base-structure.html\'"></div>\r\n</div>'),e.put("templates/navbar.html",'<div id="webYiHeader">\r\n	<div id="webYiLogo"><strong>{{app.name}}</strong></div>\r\n	<ul id="webYitopNav" class="main-header-nav">\r\n		<li ng-class="{active: app.active==\'home\'}"><a href="#">首页</a></li>\r\n		<li ng-class="{active: app.active==\'appitem\'}"><a href="#appitem">项目列表</a></li>\r\n		<li ng-class="{active: app.active==\'ide\'}"><a href="#ide">ide</a></li>\r\n	</ul>\r\n</div>'),e.put("templates/plan-status.html",'<div class="plan-status-btn-group">\r\n	<span ng-class="{active:status==\'inprogress\'}" style="background:#ff6600" title="进行中" ng-click="setStatus(\'inprogress\')">.</span>\r\n	<span ng-class="{active:status==\'complete\'}" style="background:green" title="完成" ng-click="setStatus(\'complete\')">.</span>\r\n	<span ng-class="{active:status==\'problem\'}" style="background:red" title="有问题" ng-click="setStatus(\'problem\')">.</span>\r\n</div>'),e.put("templates/project-sidebar.html",'<ul ng-controller="ProjectSidebarCtrl">\r\n	<li class="sideber-manage-btn">\r\n		<span ng-click="generateAppItem()"><i class="icon-random"></i>生成应用</span>\r\n		<span ng-click="runAppItem()"><i class="icon-play"></i>启动应用</span>\r\n	</li>\r\n	<li>\r\n		<div>\r\n			<span>数据模型管理</span>\r\n			<span class="project-sidebar-dir">/service/models|schemas/</span>\r\n			<a ui-sref="schema.create" class="icon-plus sidebar-add-btn" title="添加"></a>\r\n		</div>\r\n		<ul class="">\r\n			<li class="sidebar-item-li" ng-repeat="schema in Schema._models">\r\n				<a ui-sref="schema.update({_id: schema._id})" class="project-sidebar-title">\r\n					<span>{{schema.model_name}}</span> \r\n					<span class="sidebar-item-title">{{schema.title}}</span>\r\n				</a>\r\n				<div class="project-sidebar-li-right">\r\n					<div plan-status="Schema.save(schema)" ng-model="schema.plan_status"></div>\r\n					<a class="icon-minus" ng-click="Schema.delByIndex($index)" title="删除"></a>\r\n					<a class="icon-repeat" title="测试"></a>\r\n				</div>\r\n			</li>\r\n		</ul>\r\n	</li>\r\n	<li>\r\n		<div>\r\n			<span>URL请求管理</span>\r\n			<span class="project-sidebar-dir">/service/routes.coffee</span>\r\n			<a ui-sref="requrl.create" class="icon-plus sidebar-add-btn" title="添加"></a>\r\n		</div>\r\n		<ul>\r\n			<li class="sidebar-item-li" ng-repeat="requrl in Requrl._models">\r\n				<a ui-sref="requrl.update({_id: requrl._id})" class="project-sidebar-title">\r\n					<span>{{requrl.path}}</span> \r\n					<span class="sidebar-item-title">{{requrl.title}}</span>\r\n				</a>\r\n				<div class="project-sidebar-li-right">\r\n					<div plan-status="Requrl.save(requrl)" ng-model="requrl.plan_status"></div>\r\n					<a class="icon-minus" ng-click="Requrl.delByIndex($index)" title="删除"></a>\r\n					<a class="icon-repeat" title="测试"></a>\r\n				</div>\r\n			</li>\r\n		</ul>\r\n	</li>\r\n	<li>\r\n		<div>\r\n			<span>功能单元管理</span>\r\n			<span class="project-sidebar-dir">/service/actions/</span>\r\n			<a ui-sref="action.create" class="icon-plus sidebar-add-btn" title="添加"></a>\r\n		</div>\r\n		<ul>\r\n			<li class="sidebar-item-li" ng-repeat="action in Action._models | orderBy: \'name\'">\r\n				<a ui-sref="action.update({_id: action._id})" class="project-sidebar-title">\r\n					<span>{{action.name}}</span> \r\n					<span class="sidebar-item-title">{{action.intro}}</span>\r\n				</a>\r\n				<div class="project-sidebar-li-right">\r\n					<div plan-status="Action.save(action)" ng-model="action.plan_status"></div>\r\n					<a class="icon-minus" ng-click="Action.delByIndex($index)" title="删除"></a>\r\n					<a class="icon-repeat" title="测试"></a>\r\n				</div>\r\n			</li>\r\n		</ul>\r\n	</li>\r\n	<li>\r\n		<div>\r\n			<span>代码文件管理</span>\r\n			<span class="project-sidebar-dir">/</span>\r\n			<a ui-sref="codefile.create" class="icon-plus sidebar-add-btn" title="添加"></a>\r\n		</div>\r\n		<ul>\r\n			<li class="sidebar-item-li" ng-repeat="codefile in CodeFile._models">\r\n				<a ui-sref="codefile.update({_id: codefile._id})" class="project-sidebar-title">\r\n					<span>{{codefile.name}}</span> \r\n					<span class="sidebar-item-title">{{codefile.intro}}</span>\r\n				</a>\r\n				<div class="project-sidebar-li-right">\r\n					<div plan-status="CodeFile.save(codefile)" ng-model="codefile.plan_status"></div>\r\n					<a class="icon-minus" ng-click="CodeFile.delByIndex($index)" title="删除"></a>\r\n					<a class="icon-repeat" title="测试"></a>\r\n				</div>\r\n			</li>\r\n		</ul>\r\n	</li>\r\n</ul>'),e.put("templates/requrl-form.html",'<div ng-controller="RequrlCtrl">\r\n	<form ng-submit="save()" on-ctrl-s="save()">\r\n		<ul class="form-header" ng-init="show_tab=2">\r\n			<li ng-click="show_tab=1" ng-class="{active: show_tab==1}">需求配置</li>\r\n			<li ng-click="show_tab=2" ng-class="{active: show_tab==2}">实现代码</li>\r\n			<li ng-click="show_tab=3" ng-class="{active: show_tab==3}">测试代码</li>\r\n		</ul>\r\n		<div class="form-main no-code" ng-if="show_tab==1">\r\n			<div>\r\n				<input ng-model="model.title" type="text" placeholder="接口名称" />\r\n				<input ng-model="model.path" type="text" placeholder="接口地址" />\r\n				<select ng-model="model.type" ng-options="type for type in requrl.request_types"></select>\r\n				<div>\r\n					<textarea ng-model="model.intro" style="width:90%" rows="3" placeholder="接口描述"></textarea>\r\n				</div>\r\n			</div>\r\n\r\n			<h4>HEADER参数</h4>\r\n			<ul>\r\n				<li ng-repeat="header in model.headers">\r\n					<input ng-model="header.name" type="text" placeholder="参数名称" />\r\n					<input ng-model="header.value" type="text" placeholder="参数值" />\r\n					<select ng-model="header.value_type" ng-options="value_type for value_type in requrl.value_types"></select>\r\n					<input ng-model="header.intro" type="text" placeholder="参数描述" />\r\n					<a class="btn" ng-click="delParame(\'headers\', $index)">-</a>\r\n				</li>\r\n				<li><a class="btn" ng-click="addParame(\'headers\')">+增加</a></li>\r\n			</ul>\r\n\r\n			<h4>GET参数</h4>\r\n			<ul>\r\n				<li ng-repeat="get in model.gets">\r\n					<input ng-model="get.name" type="text" placeholder="参数名称" />\r\n					<input ng-model="get.value" type="text" placeholder="参数值" />\r\n					<select ng-model="get.value_type" ng-options="value_type for value_type in requrl.value_types"></select>\r\n					<input ng-model="get.intro" type="text" placeholder="参数描述" />\r\n					<a class="btn" ng-click="delParame(\'gets\', $index)">-</a>\r\n				</li>\r\n				<li><a class="btn" ng-click="addParame(\'gets\')">+增加</a></li>\r\n			</ul>\r\n\r\n			<h4>POST参数</h4>\r\n			<ul>\r\n				<li ng-repeat="post in model.posts">\r\n					<input ng-model="post.name" type="text" placeholder="参数名称" />\r\n					<input ng-model="post.value" type="text" placeholder="参数值" />\r\n					<select ng-model="post.value_type" ng-options="value_type for value_type in requrl.value_types"></select>\r\n					<input ng-model="post.intro" type="text" placeholder="参数描述" />\r\n					<a class="btn" ng-click="delParame(\'posts\', $index)">-</a>\r\n				</li>\r\n				<li><a class="btn" ng-click="addParame(\'posts\')">+增加</a></li>\r\n			</ul>\r\n		</div>\r\n		<div class=\'form-main\' ng-if="show_tab==2">\r\n			<div ui-ace="{\r\n				useWrapMode : true,\r\n				showGutter: true,\r\n				theme:\'monokai\',\r\n				mode: \'coffee\',\r\n				onLoad: aceLoaded\r\n			}" ng-model="model.code" placeholder="实现代码"></div>\r\n		</div>\r\n		<div class=\'form-main\' ng-if="show_tab==3">\r\n			<div ui-ace="{\r\n				useWrapMode : true,\r\n				showGutter: true,\r\n				theme:\'monokai\',\r\n				mode: \'coffee\',\r\n				onLoad: aceLoaded\r\n			}" ng-model="model.test_code" placeholder="测试代码"></div>\r\n		</div>\r\n		<div class="form-footer">\r\n			<input class="btn btn-primary" type="submit" value="保存" />\r\n		</div>\r\n	</form>\r\n</div>\r\n'),e.put("templates/schema-form.html",'<div ng-controller="SchemaCtrl" class="schema-main">\r\n	<form ng-submit="save()" method="post" accept-charset="utf-8" on-ctrl-s="save()">\r\n		<div class="form-main no-code">\r\n			<p>模型名称：<input type="text" ng-model="schema.model_name" /> 表名称：<input type="text" ng-model="schema.table_name" /></p>\r\n			<table class="table table-bordered" width="100%">\r\n				<thead>\r\n					<tr>\r\n						<th width="100">字段名</th>\r\n						<th width="100">字段类型</th>\r\n						<th width="100">可用SCHEMA</th>\r\n						<th width="100">取值范围</th>\r\n						<th width="100">默认值</th>\r\n						<th width="100">描述</th>\r\n						<th width="20">操作</th>\r\n					</tr>\r\n				</thead>\r\n				<tr ng-repeat="field in schema.fields">\r\n					<td><input class="td-input" type="text" ng-model="field.name" /></td>\r\n					<td>\r\n						<select class="td-input" ng-model="field.type" ng-options="type for type in field_types"></select>\r\n					</td>\r\n					<td>\r\n						<select class="td-input" ng-model="field.sub_schema" ng-options="sub_schema for sub_schema in schemas"></select>\r\n					</td>\r\n					<td>\r\n						<div ng-click="field.enums_shown=true">&nbsp;\r\n							[<span ng-repeat="_enum in field.enums">{{_enum.value}},</span>]\r\n						</div>\r\n						<div ng-show="field.enums_shown" class="modal">\r\n							<div class="modal-header">\r\n								<a class="close" ng-click="field.enums_shown=false">×</a>\r\n								<h3 class="modal-title">取值范围</h3>\r\n							</div>\r\n							<div class="modal-body">\r\n								<div>不填默认为任意值</div>\r\n								<ul>\r\n									<li ng-repeat="enum in field.enums">\r\n										<input type="text" ng-model="enum.value" />\r\n										<a class="btn" ng-click="delEnum(field, $index)">-</a>\r\n									</li>\r\n									<li><a class="btn" ng-click="addEnum(field)">+增加</a></li>\r\n								</ul>\r\n							</div>\r\n							<div class="modal-footer">\r\n								<a ng-click="field.enums_shown=false" class="btn btn-primary">确定</a>\r\n							</div>\r\n						</div>\r\n					</td>\r\n					<td><input class="td-input" type="text" ng-model="field.default" /></td>\r\n					<td><input class="td-input" type="text" ng-model="field.intro" /></td>\r\n					<td><a class="btn" title="删除" ng-click="delField($index)">-</a></td>\r\n				</tr>\r\n			</table>\r\n			<a class="btn" ng-click="addField()">+增加字段</a>\r\n			<input class="btn btn-primary" type="submit" value="保存" />\r\n		</div>\r\n	</form>\r\n</div>')
}])}(window);